@model Exampler_ERP.Models.FI_Vouchar

<div class="modal fade" id="addVoucharModal" tabindex="-1" role="dialog" aria-labelledby="addVoucharModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document" style="--bs-modal-width: 80rem;">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title" id="addVoucharModalLabel"><i class="fas fa-key me-2"></i>Add Journal Voucher</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addVoucherForm" method="post">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="VoucharTypeID" class="form-label fw-bold">Voucher Type</label>
                            <select asp-for="VoucharTypeID" class="form-select form-select-lg">
                                <option value="">Select Voucher Type</option>
                                @foreach (var type in ViewBag.VoucharTypeList)

                                {
                                    <option value="@type.Value">@type.Text</option>
                                }
                            </select>
                        </div>
                        
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label for="PONo" class="form-label fw-bold">PO No</label>
                            <input type="text" class="form-control form-control-lg" id="PONo" name="PONo" value="@Model.PONo" />
                        </div>
                        <div class="col-md-3">
                            <label for="GRNNo" class="form-label fw-bold">GRN No</label>
                            <input type="text" class="form-control form-control-lg" id="GRNNo" name="GRNNo" value="@Model.GRNNo" />
                        </div>
                        <div class="col-md-3">
                            <label for="DCNo" class="form-label fw-bold">DC No</label>
                            <input type="text" class="form-control form-control-lg" id="DCNo" name="DCNo" value="@Model.DCNo" />
                        </div>
                        <div class="col-md-3">
                            <label for="InvoiceNo" class="form-label fw-bold">Invoice No</label>
                            <input type="text" class="form-control form-control-lg" id="InvoiceNo" name="InvoiceNo" value="@Model.InvoiceNo" />
                        </div>
                        <div class="col-md-12">
                            <label asp-for="Description" class="form-label fw-bold">Description</label>
                            <textarea asp-for="Description" class="form-control form-control-lg" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-bordered" id="JournalVoucherTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Transaction Type</th>
                                    <th>Transaction Account</th>
                                    <th>Debit Amount</th>
                                    <th>Credit Amount</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <select class="form-select transaction-account">
                                            <option value="">Select Type</option>
                                            @foreach (var type in ViewBag.TransactionTypeList)

                                            {
                                                <option value="@type.Value">@type.Text</option>
                                            }
                                        </select>
                                    </td>
                                    <td>
                                        <select class="form-select transaction-account select-account" style="width: 100%;">
                                            <option value="">Select Account</option>
                                            @foreach (var account in ViewBag.HeadofAccount_FiveList)
                                            {
                                                <option value="@account.Value">@account.Text</option>
                                            }
                                        </select>
                                    </td>

                                    <td>
                                        <input class="form-control debit" type="number" step="0.01" />
                                    </td>
                                    <td>
                                        <input class="form-control credit" type="number" step="0.01" />
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger" onclick="removeRow(this)">Remove</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" id="addRow" class="btn btn-primary mt-2">Add Row</button>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Total Debit Amount</label>
                            <input id="TotalDrAmt" class="form-control form-control-lg" readonly />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Total Credit Amount</label>
                            <input id="TotalCrAmt" class="form-control form-control-lg" readonly />
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" id="saveNewVoucher" class="btn btn-success">Save Voucher</button>
            </div>
        </div>
    </div>
</div>

<script>
   $(document).ready(function () {

    // Initialize Select2 for existing elements
    $('.select-account').select2({
        placeholder: "Search Account...",
        allowClear: true,
        width: '100%'
    });

    // Add new row functionality
    $('#addRow').on('click', function () {
        let newRow = `<tr>
                    <td>
                        <select class="form-select transaction-account">
                            <option value="">Select Transaction Type</option>
                            @foreach (var type in ViewBag.TransactionTypeList)
                            {
                                <option value="@type.Value">@type.Text</option>
                            }
                        </select>
                    </td>
                    <td>
                        <select class="form-select select-account" style="width: 100%;">
                            <option value="">Select Account</option>
                            @foreach (var account in ViewBag.HeadofAccount_FiveList)
                            {
                                <option value="@account.Value">@account.Text</option>
                            }
                        </select>
                    </td>
                    <td>
                        <input class="form-control debit" type="number" step="0.01" />
                    </td>
                    <td>
                        <input class="form-control credit" type="number" step="0.01" />
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger" onclick="removeRow(this)">Remove</button>
                    </td>
                </tr>`;

        $('#JournalVoucherTable tbody').append(newRow);

        // Reinitialize Select2 for the new select elements after the row is added
        $('.select-account').last().select2({
            placeholder: "Search Account...",
            allowClear: true,
            width: '100%'
        });
    });

    // Remove row functionality
    window.removeRow = function (button) {
        $(button).closest('tr').remove();
        calculateTotals();
    };

    // Calculate totals dynamically
    $(document).on('input', '.debit, .credit', function () {
        calculateTotals();
    });

    function calculateTotals() {
        let totalDebit = 0;
        let totalCredit = 0;

        $('#JournalVoucherTable tbody tr').each(function () {
            const debit = parseFloat($(this).find('.debit').val()) || 0;
            const credit = parseFloat($(this).find('.credit').val()) || 0;

            totalDebit += debit;
            totalCredit += credit;
        });

        $('#TotalDrAmt').val(totalDebit.toFixed(2));
        $('#TotalCrAmt').val(totalCredit.toFixed(2));
    }
  
});

</script>
<style>
  .select2-container {
    width: 100% !important;
    Z-INDEX: 9999;
}
</style>
